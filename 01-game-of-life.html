<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game of Life</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.8/dist/cdn.min.js"></script>
    <style>
        .game-form {
            display: flex;
            flex-direction: column;
        }

        .game-row {
            display: flex;
            flex-direction: row;
        }

        .game-cell {
            margin: 1px;
            height: 48px;
            width: 48px;
            background-color: darkgray;
            box-sizing: border-box;
        }

        .game-cell:hover {
            border: 4px solid green;
        }

        .alive {
            background-color: black;
        }
        .dead {
            background-color: gray;
        }
    </style>
</head>

<body x-data="new GameData">
    <h1>Game of Life</h1>
    <section>
        <h2>Spiel erstellen</h2>
        <form action="" @submit.prevent="generateGrid(width, height)"
            class="game-form">
            <label for="game-width">Breite</label>
            <input type="number" name="game-width" id="game-width" x-model="width">

            <label for="game-height">HÃ¶he</label>
            <input type="number" name="game-height" id="game-height" x-model="height">

            <button type="submit">
                Erstellen
            </button>
        </form>
    </section>

    <section>
        <h2>Spielen</h2>
        <p>Current Turn: <span x-text="turn"></span></p>
        <template x-for="(row, y) in grid">
            <div class="game-row">
                <template x-for="(life, x) in row">
                    <div class="game-cell" :class="life ? 'alive' : 'dead'" @click="toggle(x, y)">
                    </div>
                </template>
            </div>
        </template>
        <button type="button" @click="update()">
            Update
        </button>
    </section>

    <script>
        class GameData {
            grid = [[]]
            width = 10
            height = 10
            turn = 0

            static createGrid(w, h, f) {
                return Array.from({length: h}, (_, y) => Array.from({length: w}, (_, x) => f(x, y)))
            }

            generateGrid(w, h) {
                this.width = w
                this.height = h
                this.turn = 0
                this.grid = GameData.createGrid(w, h, (x, y) => Math.random() > 0.5)
                console.log("Generate", this.width, this.height)
            }

            isAlive(x, y) {
                if(x < 0 || x >= this.width) {
                    return false
                }

                if(y < 0 || y >= this.height) {
                    return false
                }

                return this.grid[y][x]
            }

            neighbors(x, y) {
                let count = 0
                for(let dy = -1; dy <= 1; dy++) {
                    for(let dx = -1; dx <= 1; dx++) {
                        if(dx != 0 && dy != 0 && this.isAlive(x + dx, y + dy)) {
                            count += 1
                        }
                    }
                }
                return count
            }

            toggle(x, y) {
                this.grid[y][x] = !this.grid[y][x]
            }

            update() {
                this.turn += 1
                console.log("Update", this.width, this.height)
                console.log(this.grid)
                this.grid = GameData.createGrid(this.width, this.height, (x, y) => {
                    console.log("Update", x, y)
                    let alive = this.grid[y][x]
                    let neighbors = this.neighbors(x, y)
                    console.log(alive, neighbors)

                    if(alive && (neighbors == 2 || neighbors == 3)) {
                        return true
                    }
                    else if (!alive && neighbors == 3) {
                        return true
                    }
                    else {
                        return false
                    }
                })
            }
        }
    </script>
</body>
</html>