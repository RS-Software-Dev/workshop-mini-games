<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.8/dist/cdn.min.js"></script>
    <style>
        .game-view {
            background-color: lightgray;
        }

        #myCanvas {
            background-color: lightgray;
        }
    </style>
</head>

<body>
    <section>
        <h2>With Canvas</h2>
        <canvas id="myCanvas"></canvas>

        <script type="text/javascript">
            // Within the script-tag you have to write Javascript


            /*******************************************************
              * GAME LOGIC VARIABLES
              *******************************************************/

            const Direction = {
                UP: 1,
                RIGHT: 2,
                DOWN: 3,
                LEFT: 4
            };

            var tileSize = 15;
            var nrOfTilesInX = 50;
            var nrOfTilesInY = 30;

            var snakeColor = "red";
            var snakeX = 2;
            var snakeY = 2;
            var snakeDirection = Direction.RIGHT;

            var foodColor = "green";
            var foodX = getRandomNumber(0, nrOfTilesInX - 1);
            var foodY = getRandomNumber(0, nrOfTilesInY - 1);

            var score = 0;


            /*******************************************************
            * CANVAS VARIABLES
            *******************************************************/

            var canvas = document.getElementById("myCanvas");
            var ctx = canvas.getContext("2d");

            ctx.canvas.width = nrOfTilesInX * tileSize;
            ctx.canvas.height = nrOfTilesInY * tileSize;


            /*******************************************************
            * GAME LOOP
            *******************************************************/

            function gameLoop() {
                clearCanvas();

                moveSnake();

                checkFoodCollision();
                checkWallCollision();

                // draw snake
                fillTile(snakeX, snakeY, snakeColor);

                // draw food
                fillTile(foodX, foodY, foodColor);

                drawText("Score: " + score, "20px Arial", "black", 10, canvas.height - 10);
            }

            var gameLoopInterval = setInterval(gameLoop, 100);


            /*******************************************************
            * GAME LOGIC FUNCTIONS
            *******************************************************/

            function moveSnake() {
                if (snakeDirection == Direction.UP) {
                    snakeY = snakeY - 1;
                } else if (snakeDirection == Direction.RIGHT) {
                    snakeX = snakeX + 1;
                } else if (snakeDirection == Direction.DOWN) {
                    snakeY = snakeY + 1;
                } else if (snakeDirection == Direction.LEFT) {
                    snakeX = snakeX - 1;
                }
            }

            function checkFoodCollision() {
                if (snakeX == foodX && snakeY == foodY) {
                    score = score + 1;
                    generateNewFood();
                }
            }

            function generateNewFood() {
                foodX = getRandomNumber(0, nrOfTilesInX - 1);
                foodY = getRandomNumber(0, nrOfTilesInY - 1);
            }

            function gameOver() {
                drawText(
                    "Game over!",
                    "60px Arial black",
                    "black",
                    canvas.width / 2 - 200,
                    canvas.height / 2
                );
                clearInterval(gameLoopInterval);
            }

            function checkWallCollision() {
                // in X direction
                if (snakeX < 0 || snakeX > nrOfTilesInX) {
                    gameOver();
                }

                // in Y direction
                if (snakeY < 0 || snakeY > nrOfTilesInY) {
                    gameOver();
                }
            }


            /*******************************************************
            * DRAWING FUNCTIONS
            *******************************************************/

            function fillTile(x, y, color) {
                ctx.beginPath();
                ctx.rect(x * tileSize, y * tileSize, tileSize, tileSize);
                ctx.fillStyle = color;
                ctx.fill();
                ctx.closePath();
            }

            function clearCanvas() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }

            function drawText(text, font, color, x, y) {
                ctx.beginPath();
                ctx.font = font;
                ctx.fillStyle = color;
                ctx.fillText(text, x, y);
                ctx.closePath();
            }


            /*******************************************************
              * USER INTERACTION FUNCTIONS
              *******************************************************/

            function keyPressed(event) {
                if (event.key == "ArrowUp") {
                    snakeDirection = Direction.UP;
                } else if (event.key == "ArrowRight") {
                    snakeDirection = Direction.RIGHT;
                } else if (event.key == "ArrowDown") {
                    snakeDirection = Direction.DOWN;
                } else if (event.key == "ArrowLeft") {
                    snakeDirection = Direction.LEFT;
                }
            }

            document.addEventListener("keydown", keyPressed);


            /*******************************************************
            * HELPER FUNCTIONS
            *******************************************************/

            function getRandomNumber(start, end) {
                return Math.ceil(Math.random() * (end - start) + start);
            }

        </script>
    </section>

  
</body>

</html>